<div class="white-top">
	<div class="container full-height">
		<div class="table full-height">
			<div class="td vertical-align-middle">
				<h1 class="flush blue">My Feed</h1>
			</div>
		</div>
	</div>
</div>
<div class="table full-width full-height__header" data-ng-show="loading">
	<div class="td full-height full-width vertical-align-middle text-center">
		<div class="box island inline-block text-center">
			<h1 class="flush blue">Loading feed...</h1>
		</div>
	</div>
</div>
<div class="container soft-half--ends" data-ng-show="!loading">
	<div data-ng-repeat="activity in activities | orderBy:'-updatedOn'">
		<div data-ng-show="activity.activity == 'subscribed'" class="soft-half--ends">
			<div class="table full-width">
				<div class="tr">
					<div class="td one-twelfth">
						<div class="user-img-event" data-ng-style="{'background-image': 'url(' + activity.actor.pictureUrl + ')'}">
							<a href data-tooltip="{{activity.actor.businessName}}" data-tooltip-placement="left" data-ng-href="/profile/{{activity.actor.username}}" data-ng-show="activity.actor.type == 'business'"></a>
							<a href data-tooltip="{{activity.actor.firstName}} {{activity.actor.lastName}}" data-tooltip-placement="left" data-ng-href="/profile/{{activity.actor.username}}" data-ng-show="activity.actor.type == 'student'"></a>
						</div>
					</div>
					<div class="td eleven-twelfths vertical-align-middle">
						<p>
							<a href data-ng-href="/profile/{{activity.actor.username}}" data-ng-show="activity.actor.type =='student'">{{activity.actor.firstName}} {{activity.actor.lastName}}</a>
							<a href data-ng-href="/profile/{{activity.actor.username}}" data-ng-show="activity.actor.type =='business'">{{activity.actor.businessName}}</a>
							 subscribed to
							  <span data-ng-show="activity.recipient._id == user._id" class="weight--bold">you.</span>
							  <span data-ng-hide="activity.recipient._id == user._id || activity.recipient.type =='business'" class="weight--bold">{{activity.recipient.firstName}} {{activity.recipient.lastName}}</span>
							  <span data-ng-hide="activity.recipient._id == user._id || activity.recipient.type =='student'" class="weight--bold">{{activity.recipient.businessName}}</span>
						</p>
					</div>
				</div>
			</div>
		</div>
		<div data-ng-show="activity.activity == 'invited'" class="soft-half--ends">
			<p>
				<a href data-ng-href="/profile/{{activity.actor.username}}" data-ng-show="activity.actor.type =='student'">{{activity.actor.firstName}} {{activity.actor.lastName}}</a>
				<a href data-ng-href="/profile/{{activity.actor.username}}" data-ng-show="activity.actor.type =='business'">{{activity.actor.businessName}}</a>
				 invited you to:
			</p>
			<div class="line nudge-half--ends">
				<div class="unit one-twelfth">
					<div class="user-img-event" data-ng-style="{'background-image': 'url(' + activity.event.creator.pictureUrl + ')'}">
						<a href data-tooltip="{{activity.event.creator.businessName}}" data-tooltip-placement="left" data-ng-href="/profile/{{activity.event.creator.username}}" data-ng-show="activity.event.creator.type == 'business'"></a>
						<a href data-tooltip="{{activity.event.creator.firstName}} {{activity.event.creator.lastName}}" data-tooltip-placement="left" data-ng-href="/profile/{{activity.event.creator.username}}" data-ng-show="activity.event.creator.type == 'student'"></a>
					</div>
				</div>
				<div class="unit eleven-twelfths last-unit">
					<div class="box">
						<div class="event-header soft-half--sides">
							<h2 class="flush">
								<i class="zeta icon-unlock nudge-half--right" data-ng-show="activity.event.privacy == 'public'"></i>
								<i class="zeta icon-lock nudge-half--right" data-ng-show="activity.event.privacy == 'inviteonly'"></i>
								{{ activity.event.title }}
							</h2>
							<a data-ng-href="/event/{{activity.event._id}}" class="block-link"></a>
						</div>
						<div class="islet">
							<div class="line">
								<div class="unit four-fifths">
									<span class="delta weight--bold">
										<span data-ng-show="activity.event.locationName" class="nudge-half--right">
											<i class="icon-map-marker muted"></i> <span data-ng-bind="activity.event.locationName"></span> 
										</span>
										<span data-ng-show="activity.event.startDate" class="nudge-half--right">
											<i class="icon-calendar-empty muted"></i> <span>{{ activity.event.startDate | readableDate }}</span>
										</span>
										<span data-ng-show="activity.event.startTime">
											<i class="icon-time muted"></i> <span data-ng-bind="activity.event.startTime"></span>
										</span>
									</span>
								</div>
								<div class="unit one-fifth last-unit text-right">
									<ul class="tags">
										<li data-ng-repeat="tag in activity.event.tags" data-ng-bind="tag"></li>
									</ul>
								</div>
							</div>
							<p class="pre-wrap" data-ng-bind-html="activity.event.description | parseUrl"></p>
							<div class="line nudge-half--top">
								<div class="unit one-half">
									<div class="action-buttons">
										<a class="first" data-ng-class="{green: isAttending(activity.event)}" href data-ng-click="openAttending(activity.event._id)" data-tooltip="People Attending"><span class="gamma" data-ng-class="{green: isAttending(activity.event)}">{{ activity.event.attending.length }}</span></a>
										<a href data-ng-click="rsvpToEvent(activity.event._id)" data-ng-hide="isAttending(activity.event)"><i class="icon-thumbs-up"></i> RSVP</a>
										<a href data-ng-click="unRsvpToEvent(activity.event._id)" data-ng-show="isAttending(activity.event)"><i class="icon-thumbs-up-alt"></i> Un-RSVP</a>
									</div>
								</div>
								<div class="unit one-half last-unit text-right">
									<div class="action-buttons green">
										<a href data-ng-href="/event/{{activity.event._id}}">Details <i class="icon-chevron-right epsilon"></i></a>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div><!-- event end -->
		</div>
		<div data-ng-show="activity.activity == 'posted'" class="soft-half--ends">
			<p>
				<a href data-ng-href="/profile/{{activity.actor.username}}" data-ng-show="activity.actor.type =='student'">{{activity.actor.firstName}} {{activity.actor.lastName}}</a>
				<a href data-ng-href="/profile/{{activity.actor.username}}" data-ng-show="activity.actor.type =='business'">{{activity.actor.businessName}}</a>
				 posted an event:
			</p>
			<div class="line nudge-half--ends">
				<div class="unit one-twelfth">
					<div class="user-img-event" data-ng-style="{'background-image': 'url(' + activity.actor.pictureUrl + ')'}">
						<a href data-tooltip="{{activity.actor.businessName}}" data-tooltip-placement="left" data-ng-href="/profile/{{activity.actor.username}}" data-ng-show="activity.actor.type == 'business'"></a>
						<a href data-tooltip="{{activity.actor.firstName}} {{activity.actor.lastName}}" data-tooltip-placement="left" data-ng-href="/profile/{{activity.actor.username}}" data-ng-show="activity.actor.type == 'student'"></a>
					</div>
				</div>
				<div class="unit eleven-twelfths last-unit">
					<div class="box">
						<div class="event-header soft-half--sides">
							<h2 class="flush">
								<i class="zeta icon-unlock nudge-half--right" data-ng-show="activity.event.privacy == 'public'"></i>
								<i class="zeta icon-lock nudge-half--right" data-ng-show="activity.event.privacy == 'inviteonly'"></i>
								{{ activity.event.title }}
							</h2>
							<a data-ng-href="/event/{{activity.event._id}}" class="block-link"></a>
						</div>
						<div class="islet">
							<div class="line">
								<div class="unit four-fifths">
									<span class="delta weight--bold">
										<span data-ng-show="activity.event.locationName" class="nudge-half--right">
											<i class="icon-map-marker muted"></i> <span data-ng-bind="activity.event.locationName"></span> 
										</span>
										<span data-ng-show="activity.event.startDate" class="nudge-half--right">
											<i class="icon-calendar-empty muted"></i> <span>{{ activity.event.startDate | readableDate }}</span>
										</span>
										<span data-ng-show="activity.event.startTime">
											<i class="icon-time muted"></i> <span data-ng-bind="activity.event.startTime"></span>
										</span>
									</span>
								</div>
								<div class="unit one-fifth last-unit text-right">
									<ul class="tags">
										<li data-ng-repeat="tag in activity.event.tags" data-ng-bind="tag"></li>
									</ul>
								</div>
							</div>
							<p class="pre-wrap" data-ng-bind-html="activity.event.description | parseUrl"></p>
							<div class="line nudge-half--top">
								<div class="unit one-half">
									<div class="action-buttons">
										<a class="first" data-ng-class="{green: isAttending(activity.event)}" href data-ng-click="openAttending(activity.event._id)" data-tooltip="People Attending"><span class="gamma" data-ng-class="{green: isAttending(activity.event)}">{{ activity.event.attending.length }}</span></a>
										<a href data-ng-click="rsvpToEvent(activity.event._id)" data-ng-hide="isAttending(activity.event)"><i class="icon-thumbs-up"></i> RSVP</a>
										<a href data-ng-click="unRsvpToEvent(activity.event._id)" data-ng-show="isAttending(activity.event)"><i class="icon-thumbs-up-alt"></i> Un-RSVP</a>
									</div>
								</div>
								<div class="unit one-half last-unit text-right">
									<div class="action-buttons green">
										<a href data-ng-href="/event/{{activity.event._id}}">Details <i class="icon-chevron-right epsilon"></i></a>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div><!-- event end -->
		</div>
		<div data-ng-show="activity.activity == 'rsvpd'" class="soft-half--ends">
			<p>
				<a href data-ng-href="/profile/{{activity.actor.username}}" data-ng-show="activity.actor.type =='student'">{{activity.actor.firstName}} {{activity.actor.lastName}}</a>
				<a href data-ng-href="/profile/{{activity.actor.username}}" data-ng-show="activity.actor.type =='business'">{{activity.actor.businessName}}</a>
				 RSVP'd to an event:
			</p>
			<div class="line nudge-half--ends">
				<div class="unit one-twelfth">
					<div class="user-img-event" data-ng-style="{'background-image': 'url(' + activity.event.creator.pictureUrl + ')'}">
						<a href data-tooltip="{{activity.event.creator.businessName}}" data-tooltip-placement="left" data-ng-href="/profile/{{activity.event.creator.username}}" data-ng-show="activity.event.creator.type == 'business'"></a>
						<a href data-tooltip="{{activity.event.creator.firstName}} {{activity.event.creator.lastName}}" data-tooltip-placement="left" data-ng-href="/profile/{{activity.event.creator.username}}" data-ng-show="activity.event.creator.type == 'student'"></a>
					</div>
				</div>
				<div class="unit eleven-twelfths last-unit">
					<div class="box">
						<div class="event-header soft-half--sides">
							<h2 class="flush">
								<i class="zeta icon-unlock nudge-half--right" data-ng-show="activity.event.privacy == 'public'"></i>
								<i class="zeta icon-lock nudge-half--right" data-ng-show="activity.event.privacy == 'inviteonly'"></i>
								{{ activity.event.title }}
							</h2>
							<a data-ng-href="/event/{{activity.event._id}}" class="block-link"></a>
						</div>
						<div class="islet">
							<div class="line">
								<div class="unit four-fifths">
									<span class="delta weight--bold">
										<span data-ng-show="activity.event.locationName" class="nudge-half--right">
											<i class="icon-map-marker muted"></i> <span data-ng-bind="activity.event.locationName"></span> 
										</span>
										<span data-ng-show="activity.event.startDate" class="nudge-half--right">
											<i class="icon-calendar-empty muted"></i> <span>{{ activity.event.startDate | readableDate }}</span>
										</span>
										<span data-ng-show="activity.event.startTime">
											<i class="icon-time muted"></i> <span data-ng-bind="activity.event.startTime"></span>
										</span>
									</span>
								</div>
								<div class="unit one-fifth last-unit text-right">
									<ul class="tags">
										<li data-ng-repeat="tag in activity.event.tags" data-ng-bind="tag"></li>
									</ul>
								</div>
							</div>
							<p class="pre-wrap" data-ng-bind-html="activity.event.description | parseUrl"></p>
							<div class="line nudge-half--top">
								<div class="unit one-half">
									<div class="action-buttons">
										<a class="first" data-ng-class="{green: isAttending(activity.event)}" href data-ng-click="openAttending(activity.event._id)" data-tooltip="People Attending"><span class="gamma" data-ng-class="{green: isAttending(activity.event)}">{{ activity.event.attending.length }}</span></a>
										<a href data-ng-click="rsvpToEvent(activity.event._id)" data-ng-hide="isAttending(activity.event)"><i class="icon-thumbs-up"></i> RSVP</a>
										<a href data-ng-click="unRsvpToEvent(activity.event._id)" data-ng-show="isAttending(activity.event)"><i class="icon-thumbs-up-alt"></i> Un-RSVP</a>
									</div>
								</div>
								<div class="unit one-half last-unit text-right">
									<div class="action-buttons green">
										<a href data-ng-href="/event/{{activity.event._id}}">Details <i class="icon-chevron-right epsilon"></i></a>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div><!-- event end -->
		</div>
		<div data-ng-show="activity.activity == 'commented'" class="soft-half--ends">
			<p>
				<a href data-ng-href="/profile/{{activity.actor.username}}" data-ng-show="activity.actor.type =='student'">{{activity.actor.firstName}} {{activity.actor.lastName}}</a>
				<a href data-ng-href="/profile/{{activity.actor.username}}" data-ng-show="activity.actor.type =='business'">{{activity.actor.businessName}}</a>
				 commented on the event <a href data-ng-href="/event/{{activity.event._id}}">{{activity.event.title}}</a>:
			</p>
			<div class="line nudge-half--ends">
				<div class="unit one-tenth">
					<div class="user-img-comment" data-ng-style="{'background-image': 'url(' + activity.comment.creator.pictureUrl + ')'}">
						<a href data-ng-show="activity.comment.creator.type == 'student'" data-tooltip="{{activity.comment.creator.firstName}} {{activity.comment.creator.lastName}}" data-tooltip-placement="left" data-ng-href="profile/{{activity.comment.creator.username}}"></a>
						<a href data-ng-show="activity.comment.creator.type == 'business'" data-tooltip="{{activity.comment.creator.businessName}}" data-tooltip-placement="left" data-ng-href="profile/{{activity.comment.creator.username}}"></a>
					</div>
				</div>
				<div class="unit nine-tenths last-unit">
					<div class="box islet comment">
						<p class="nudge-half--bottom pre-wrap" data-ng-bind-html="activity.comment.body | parseUrl"></p>
						<div class="table full-width">
							<div class="td one-half">
								<div class="action-buttons comment nudge-half--top">
									<a class="first" href><span class="gamma" data-ng-class="{green: likesComment(activity.comment)}">{{ comment.likes.length }}</span></a>
									<a href data-ng-click="likeComment(activity.comment)" data-ng-hide="likesComment(activity.comment)">
										<i class="icon-heart"></i> Like
									</a>
									<a href data-ng-click="unlikeComment(activity.comment)" data-ng-show="likesComment(activity.comment)">
										<i class="icon-heart-empty"></i> Unlike
									</a>
								</div>
							</div>
							<div class="td one-half text-right">
								<span class="muted epsilon" data-ng-bind="activity.comment.posted | timePast"></span>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
		<hr />
	</div>
	<div data-ng-show="!activities.length && !loading">
		<h1 class="flush blue">There hasn't been any activity related to you yet. Try subscribing to other users!</h1>
	</div>
	<a href data-ng-click="loadMore()" class="btn full-width text-center" data-ng-show="moreToLoad && !loadingMore && !loading">Load More</a>
	<a href class="btn full-width text-center" data-ng-show="loadingMore && !loading">Loading more...</a>
</div>

<script type="text/ng-template" id="attendingModal.html">
    <div class="modal-header">
        <h2 class="flush">Attending</h2>
    </div>
    <div class="modal-body">
        <ul>
            <li ng-repeat="item in items">
                <a ng-click="selected.item = item">{{ item }}</a>
            </li>
        </ul>
        Selected: <b>{{ selected.item }}</b>
    </div>
    <div class="modal-footer">
        <button class="btn" data-ng-click="ok()">Close</button>
    </div>
</script>